<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Accueil Client - Predict'IF</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>
<body>

<header>
    <h1>Predict'IF</h1>
    <div class="user-info" onclick="window.location.href = 'profil.html'">
        <span id="clientName"></span>
        <img src="avatar.jpg" alt="Profil" class="avatar">
    </div>
</header>

<main class="client-home">
    <section class="astral-info">
        <div class="circle-item">Signe du zodiaque</div>
        <div class="circle-item">Signe astrologique chinois</div>
        <div class="circle-item">Couleur Porte-bonheur</div>
        <div class="circle-item">Animal-Totem</div>
    </section>

    <section class="history">
        <h2>Historique des Voyances</h2>
        <table>
            <thead>
                <tr>
                    <th>Conseillers</th>
                    <th>Dénomination</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody>
                <tr onclick="openMediumModal('Médium 1', 'Cartomancienne')">
                    <td><a href="#" onclick="event.preventDefault()">Médium 1</a></td>
                    <td>Cartomancienne</td>
                    <td>02/06/2025</td>
                </tr>
                <tr onclick="openMediumModal('Médium 2', 'Spirite')">
                    <td><a href="#" onclick="event.preventDefault()">Médium 2</a></td>
                    <td>Spirite</td>
                    <td>03/06/2025</td>
                </tr>
                <tr onclick="openMediumModal('Médium 3', 'Astrologue')">
                    <td><a href="#" onclick="event.preventDefault()">Médium 3</a></td>
                    <td>Astrologue</td>
                    <td>04/06/2025</td>
                </tr>
                <tr onclick="openMediumModal('Médium 4', 'Astrologue')">
                    <td><a href="#" onclick="event.preventDefault()">Médium 4</a></td>
                    <td>Astrologue</td>
                    <td>05/06/2025</td>
                </tr>
            </tbody>
        </table>

        <div class="actions">
            <button onclick="window.location.href = 'mediums.html'">Nouvelle consultation</button>
            <button onclick="disconnect()">Déconnexion</button>
        </div>
    </section>

    <!-- Fenêtre Modale Médium -->
    <div class="modal-overlay" style="display: none;" id="mediumModalOverlay" onclick="closeMediumModal()"></div>

    <div class="modal" style="display: none;" id="mediumModal">
        <button class="close-button" onclick="closeMediumModal()">← retour</button>
        <div class="medium-info">
            <img src="avatar.jpg" alt="Medium Avatar" class="avatar-medium">
            <h2 id="mediumName">Médium</h2>
            <h3 id="mediumType">Type</h3>
            <p id="mediumDescription">Spécialiste des grandes conversations<br>au-delà de <strong>TOUTES</strong> les frontières</p>
        </div>
        <button onclick="launchConsultation()">Lancer une consultation</button>
    </div>
</main>

<script>
    // Vérifie l'authentification et récupère nom/prénom du client
    $(document).ready(function () {
        $.ajax({
            url: "ActionServlet?action=checkAuth",
            method: "GET",
            dataType: "json",
            success: function (response) {
                if (!response.connected || response.role !== "client") {
                    window.location.href = "index.html";
                } else {
                    if (response.nom && response.prenom) {
                        document.getElementById("clientName").textContent = response.prenom + " " + response.nom;
                    }
                }
            },
            error: function () {
                alert("Erreur serveur, veuillez réessayer.");
                window.location.href = "index.html";
            }
        });
    });

    function disconnect() {
        $.ajax({
            url: "ActionServlet?action=deconnexion",
            method: "GET",
            success: function () {
                window.location.href = "index.html";
            },
            error: function () {
                alert("Erreur de déconnexion.");
            }
        });
    }

    function openMediumModal(name, type) {
        document.getElementById("mediumName").textContent = name;
        document.getElementById("mediumType").textContent = type;
        document.getElementById("mediumDescription").innerHTML = "Spécialiste des grandes conversations<br>au-delà de <strong>TOUTES</strong> les frontières";
        document.getElementById("mediumModalOverlay").style.display = "block";
        document.getElementById("mediumModal").style.display = "block";
    }

    function closeMediumModal() {
        document.getElementById("mediumModalOverlay").style.display = "none";
        document.getElementById("mediumModal").style.display = "none";
    }

    function launchConsultation() {
        alert("Consultation demandée !");
        closeMediumModal();
    }
</script>

</body>
</html>
